import com.sun.xml.ws.wsdl.parser.RuntimeWSDLParser;
import com.sun.xml.ws.api.model.wsdl.*;
import com.sun.xml.ws.model.wsdl.WSDLPortImpl;
import com.sun.org.apache.xml.internal.resolver.tools.CatalogResolver;
import com.sun.org.apache.xml.internal.resolver.CatalogManager;
import org.xml.sax.EntityResolver;
import org.xml.sax.SAXException;
import com.sun.xml.ws.api.addressing.WSEndpointReference;
import com.sun.xml.ws.api.model.wsdl.*;
import javax.xml.namespace.QName;
import javax.xml.stream.XMLStreamReader;
import javax.xml.stream.XMLStreamConstants;

private static EntityResolver getResolver() {
        EntityResolver resolver = null;
        if(resolver==null) {
            // set up a manager
            CatalogManager manager = new CatalogManager();
            manager.setIgnoreMissingProperties(true);
            try {
                //if(System.getProperty(getClass().getName()+".verbose")!=null)
                    manager.setVerbosity(0);
            } catch (SecurityException e) {
                // recover by not setting the debug flag.
            }

            // parse the catalog
            ClassLoader cl = Thread.currentThread().getContextClassLoader();
            Enumeration catalogEnum;
            try {
                if(cl==null)
                    catalogEnum = ClassLoader.getSystemResources("/META-INF/jaxws-catalog.xml");
                else
                    catalogEnum = cl.getResources("/META-INF/jaxws-catalog.xml");

                while(catalogEnum.hasMoreElements()) {
                    URL url = (URL) catalogEnum.nextElement();
                    manager.getCatalog().parseCatalog(url);
                }
            } catch (IOException e) {
                e.printStackTrace();
            }

            resolver = new CatalogResolver(manager);
        }

        return resolver;
    }

File f = resource("hello_literal_identity.wsdl");
WSDLModel doc = RuntimeWSDLParser.parse(f.toURL(), new StreamSource(f.toURL().toExternalForm()),getResolver(), true,null);
WSDLService  service = doc.getService(new QName("urn:test","Hello"));
WSDLPort port = service.getFirstPort();
WSEndpointReference wsepr = port.getExtension(WSEndpointReference.class);
QName q = new QName("http://schemas.xmlsoap.org/ws/2006/02/addressingidentity", "Identity");
WSEndpointReference.EPRExtension eprExtn = wsepr.getEPRExtension(q);
XMLStreamReader xsr = eprExtn.readAsXMLStreamReader();
if (xsr.getEventType() == XMLStreamConstants.START_DOCUMENT)
    xsr.next();
assertEquals(q.getNamespaceURI(), xsr.getNamespaceURI());
assertEquals(q.getLocalPart(),xsr.getLocalName());